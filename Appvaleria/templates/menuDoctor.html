{% load static %}

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Men√∫ Doctor | Dr. Constanzo</title>
    <!-- Referencias a CSS externo se mantienen -->
    <link rel="stylesheet" href="{% static 'css/styled.css' %}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"> 
</head>
<body>
    <!--Header (Simplificado, sin botones de autenticaci√≥n)-->  
    <header class="main-header">
        <nav class="navbar container">
            <div class="logo">
                <span class="logo-text">Cl√≠nica</span> 
            </div>

            <ul class="nav-menu">
                <li><a href="{% url 'home' %}">Ir al Home P√∫blico</a></li>
            </ul>

            <div class="nav-actions">
                <!-- Acciones de navegaci√≥n eliminadas para el modo sin credenciales -->
            </div>

            <button class="mobile-menu-btn" id="mobileMenuBtn">
                <span></span>
                <span></span>
                <span></span>
            </button>
        </nav>
    </header>

    <!--Contenido principal: Dashboard del Doctor--> 
    <main class="doctor-dashboard-layout">
        <div class="container doctor-dashboard-container">
            
            <!-- 1. BARRA LATERAL (MENU DEL DOCTOR) -->
            <aside class="sidebar doctor-sidebar">
            <div class="logo-area">
                <div class="logo-initials">
                    <img src="{% static 'img/Foto perfil.png' %}" alt="Foto del Doctor">
                 </div>
            </div>
                
                <!-- Datos Est√°ticos del Doctor Mart√≠nez -->
                <div class="doctor-info-card">
                    <h2>{{ doctor.full_name }}</h2>
                    <p class="experience-years">{{ doctor.experience }}</p>
                    <div class="contact-detail">
                        <i class="fas fa-envelope"></i>
                        <p>{{ doctor.email }}</p>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-phone"></i>
                        <p>{{ doctor.phone }}</p>
                    </div>
                    <div class="contact-detail">
                        <i class="fas fa-id-card"></i>
                        <p>{{ doctor.license }}</p>
                    </div>
                </div>
                
                <nav class="doctor-nav-menu">
                    <!-- Enlaces a las vistas del doctor -->
                    <a href="{% url 'menu_doctor' %}" class="nav-item active">
                        <i class="fas fa-calendar-alt"></i> Agenda
                    </a>
                    <a href="{% url 'paciente' %}" class="nav-item">
                        <i class="fas fa-user-friends"></i> Pacientes
                    </a>
                    <a href="{% url 'ficha_medica' %}" class="nav-item">
                        <i class="fas fa-file-alt"></i> Fichas M√©dicas
                    </a>
                </nav>
            </aside>

            <!-- 2. CONTENIDO PRINCIPAL -->
            <section class="main-content doctor-content">
                
                <!-- SALUDO Y RESUMEN -->
                <div class="welcome-header">
                    <h1>Buenos d√≠as, {{ doctor.greeting }}</h1>
                    <p>Tienes <span class="highlight-number">{{ num_citas }}</span> citas programadas para hoy.</p>
                </div>

                <hr class="section-divider">

                <!-- AGENDA DE HOY -->
                <div class="agenda-section">
                    <h2>Agenda de Hoy</h2>
                    
                    {% for cita in citas_hoy %}
                    <article class="appointment-card">
                        <div class="appointment-details">
                            <h3>{{ cita.nombre }}</h3>
                            <p class="consult-type">{% if cita.estado == 'Confirmado' %}Consulta de seguimiento{% else %}Primera consulta{% endif %}</p>
                            <p class="consult-info">üóìÔ∏è {{ cita.hora }} | üìç Consultorio 301</p>
                            <p class="consult-reason">{{ cita.razon }}</p>
                        </div>
                        <div class="appointment-actions">
                            {% if cita.estado == 'Confirmado' %}
                                <span class="btn btn-confirmar">Confirmado</span>
                            {% elif cita.estado == 'Reprogramar' %}
                                <span class="btn btn-reprogramar">Reprogramar</span>
                            {% else %}
                                <span class="btn btn-pendiente">Pendiente</span>
                            {% endif %}
                            <a href="{% url 'paciente' %}" class="btn btn-outline">Ver Paciente</a>
                        </div>
                    </article>
                    {% endfor %}
                </div>

                <hr class="section-divider">

                <!-- SECCI√ìN FICHA M√âDICA (CRUD - LISTADO) -->
                <div class="recetas-section">
                    <header class="section-header-recetas">
                        <h2>Gesti√≥n de Fichas M√©dicas</h2>
                        <!-- Bot√≥n que REDIRECCIONA a la plantilla de creaci√≥n de ficha m√©dica -->
                        <a href="{% url 'ficha_medica' %}" class="btn btn-primary btn-nueva-receta">
                            <i class="fas fa-plus"></i> Crear Nueva Ficha
                        </a>
                    </header>
                    
                    <!-- Tabla de Fichas M√©dicas Existentes (simulaci√≥n de CRUD) -->
                    <div class="recetas-list-card card-shadow">
                        <p style="margin-bottom: 20px; color: #555;">Aqu√≠ puede revisar, editar y eliminar fichas m√©dicas existentes.</p>
                        
                        <!-- Estructura de la Tabla/Grid -->
                        <div class="recetas-table-grid">
                            <div class="table-header" style="display: grid; grid-template-columns: 2fr 2fr 1.5fr 1fr; font-weight: bold; padding: 10px 0; border-bottom: 2px solid #ddd; background-color: #f7f7f7;">
                                <span>Paciente</span>
                                <span>Motivo/Diagn√≥stico</span>
                                <span>Fecha</span>
                                <span>Acciones</span>
                            </div>
                            
                            {% for ficha in fichas_medicas %}
                            <div class="table-row" style="display: grid; grid-template-columns: 2fr 2fr 1.5fr 1fr; padding: 15px 0; border-bottom: 1px solid #eee;">
                                <span>{{ ficha.paciente }}</span>
                                <span style="font-style: italic;">{{ ficha.diagnostico }}</span>
                                <span>{{ ficha.fecha }}</span>
                                <span class="action-buttons">
                                    <!-- Botones CRUD -->
                                    <button class="action-btn view-btn" title="Ver Detalle"><i class="fas fa-eye"></i></button>
                                    <button class="action-btn edit-btn" title="Editar Ficha"><i class="fas fa-edit"></i></button>
                                    <button class="action-btn delete-btn" title="Eliminar Ficha"><i class="fas fa-trash-alt"></i></button>
                                </span>
                            </div>
                            {% empty %}
                                <p style="padding: 20px 0; text-align: center; color: #888; grid-column: 1 / -1;">No hay fichas m√©dicas registradas.</p>
                            {% endfor %}
                        </div>
                    </div>
                </div>

                <hr class="section-divider">

                <!-- MIS PACIENTES -->
                <div class="pacientes-section">
                    <h2>Buscar Pacientes</h2>
                    
                    <!-- Barra de B√∫squeda de Pacientes -->
                    <div class="search-bar">
                        <input type="text" placeholder="Buscar paciente..." class="patient-search-input">
                        <i class="fas fa-search"></i>
                    </div>

                    <!-- Bot√≥n para ir a la vista completa de pacientes -->
                    <a href="{% url 'paciente' %}" class="btn btn-primary">
                        <i class="fas fa-list"></i> Ver Lista Completa de Pacientes
                    </a>
                </div>
                
            </section>

        </div>
    </main>

    <!--Footer--> 
    <footer class="main-footer">
        <div class="footer-bottom">
            <p>&copy; 2025 Cl√≠nica. Todos los derechos reservados.</p>
        </div>
    </footer>


    <script src="{% static 'js/script.js' %}"></script>
</body>
</html>